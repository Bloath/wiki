# 拙诚系列产品出厂参数设置协议

>本协议适用于拙诚带有wifi功能的系列产品
>


* [通讯框架](#1)
* [通讯协议](#2)
	* [传输规则](#2.1)
	* [报文帧格式](#2.2)
	* [地址域详解](#2.4)
	* [命令字列表](#2.5)
* [相关命令详解](#2.5)


## 一、通讯框架<a name="1"></a>

* 通讯方式：串口
* 通讯介质：RS485
* 主从机：电脑为主机，设备为从机


## 二、通讯协议<a name="2"></a>

#### 2.1 传输规则<a name="2.1"></a>

* 小端传输（低字节在前，高字节在后）
* 报文字符串为**大写**

#### 2.2 报文帧格式<a name="2.2"></a>

|起始字-1|报文ID-1|控制域-1|长度-1|时间戳-4|地址域-7|命令字-1|数据-n|校验-1|结束字符-1|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|68H|||||||||16H|

* **报文ID**：任意
* **控制域**：任意
* **时间戳**：任意
* **长 度** ：1字节，表示整个报文的长度，从起始字68H到结束字16H，最大不应超过200字节
* **地址域**：任意，
* **命令字**：1字节，[命令字列表](#2.6)
* **校验字**：1字节，从68开始到校验之前的算术运算合并取反

>数据域之前的报文头，长度为16字节，数据域之后的报文尾，长度为2字节

#### 2.4 地址域详解<a name="2.5"></a>
即便为485，采用的也是单点通讯，在协议头中，地址任意写即可。

#### 2.5 命令字列表<a name="2.6"></a>
|字符|命令|备注|
|:---:|:---:|:---:|
||**设备设置命令**||
|11H|[设备初始值](#3.2.2)|表参数、地址等|
><font color="red">查询指令</font>：在命令字中并未设置任何查询指令，需要查询时，将数据域填写一个00H，则为对当前命令字所指内容的查询，例如 : <br>
<br>E1H 00H ==> 对开关阀状态的查询
<br>11H 00H ==> 对设备相关属性的查询。

## 三、相关命令详解<a name="3"></a>
><font color="red">取消BCD</font>：与之前的协议不同，不采用BCD码，都改为BIN码，即int16或int32型，有小数点的，在通讯时扩大100倍后转换为int型，例如655.35，原BCD码为00 06 55 35，现为00 00 FF FF（65535）

### 3.1 设置命令

##### 3.1.1 设备初始值（12H）<a name="3.2.2"></a>
|内容|格式|字节数|备注|
|:---:|:---:|:---:|:---:|
|表底数（L）|uint32|4||
|回转系数|uint16|2|回转体积除以0.8|
|齿轮1齿数|uint16|2||
|齿轮2齿数|uint16|2||
|地址|bytes|7||
|公称流量(0.1L)|uint8|1|`2.5L`=>`25`|


