# 拙诚系列产品出厂参数设置协议

>本协议适用于拙诚带有wifi功能的系列产品
>

[TOC]


## 一、通讯框架

* 通讯方式：串口
* 通讯介质：TTL
* 主从机：电脑为主机，设备为从机


## 二、通讯协议

#### 2.1 传输规则

* 大端传输（高字节在前，低字节在后）
* 报文字符串为**大写**

#### 2.2 报文帧格式

|起始字-1|报文ID-1|控制域-1|长度-1|时间戳-4|地址域-7|命令字-1|数据-n|校验-1|结束字符-1|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|68H|||||||||16H|

* **报文ID**：任意
* **控制域**：任意
* **时间戳**：任意
* **长 度** ：1字节，表示整个报文的长度，从起始字68H到结束字16H，最大不应超过200字节
* **地址域**：本地通讯，全为0
* **命令字**：1字节，[命令字列表](#2.6)
* **校验字**：1字节，从68开始到校验之前的算术运算合并取反

>数据域之前的报文头，长度为16字节，数据域之后的报文尾，长度为2字节



#### 2.5 命令字列表
|下发/上传|命令|备注|
|:---:|:---:|:---:|
|FEH / 无|查询暂存|保留，用于设备加入核心网，下发数据|
|11H / 无|设备相关属性|不同报警的阈值，定时上传频率等|
|/ 无|阶梯费用||
><font color="red">查询指令</font>：在命令字中并未设置任何查询指令，需要查询时，将数据域填写一个00H，则为对当前命令字所指内容的查询

## 三、相关命令详解
### 3.1 设置本地参数

|内容|格式|字节数|备注|
|:---:|:---:|:---:|:---:|
|表底数（L）|uint32|4||
|回转系数|uint16|2|回转体积除以0.8|
|齿轮1齿数|uint16|2||
|齿轮2齿数|uint16|2||
|地址|bytes|7||
|公称流量(0.1L)|uint8|1|`2.5L`=>`25`|


